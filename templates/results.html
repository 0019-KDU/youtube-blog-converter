{% extends "base.html" %}

{% block title %}Blog Generated - BlogGen Pro{% endblock %}

{% block content %}
<section class="results-section">
    <div class="container">
        <!-- Success Header -->
        <div class="success-header text-center mb-5">
            <div class="success-animation">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="success-particles">
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                </div>
            </div>
            <h2 class="success-title">Blog Generated Successfully!</h2>
            <p class="success-subtitle">Your AI-powered blog post is ready</p>
        </div>
        
        <!-- Stats Cards -->
        <div class="row g-4 mb-5">
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-value">{{ "%.1f"|format(generation_time) }}s</div>
                    <div class="stat-label">Generation Time</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-value">{{ word_count }}</div>
                    <div class="stat-label">Words</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fab fa-youtube"></i>
                    </div>
                    <div class="stat-value">{{ video_id[:8] }}...</div>
                    <div class="stat-label">Video ID</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-language"></i>
                    </div>
                    <div class="stat-value">EN</div>
                    <div class="stat-label">Language</div>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="actions-section mb-5">
            <div class="row g-3">
                <div class="col-lg-6">
                    <a href="{{ url_for('download_pdf') }}" class="btn btn-orange btn-lg w-100" id="downloadBtn">
                        <i class="fas fa-download me-2"></i>Download PDF
                    </a>
                </div>
                <div class="col-lg-3">
                    <button class="btn btn-outline-light btn-lg w-100" onclick="copyToClipboard()">
                        <i class="fas fa-copy me-2"></i>Copy Text
                    </button>
                </div>
                <div class="col-lg-3">
                    <a href="{{ url_for('generate_page') }}" class="btn btn-outline-orange btn-lg w-100">
                        <i class="fas fa-plus me-2"></i>New Blog
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Video Preview -->
        <div class="video-section mb-5">
            <div class="row">
                <div class="col-lg-4">
                    <div class="video-card">
                        <div class="video-thumbnail">
                            <iframe src="https://www.youtube.com/embed/{{ video_id }}" 
                                    width="100%" height="200" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="video-info">
                            <h6 class="video-title">{{ title }}</h6>
                            <a href="{{ youtube_url }}" target="_blank" class="video-link">
                                <i class="fas fa-external-link-alt me-1"></i>Watch Original
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8">
                    <div class="blog-preview">
                        <h4><i class="fas fa-eye me-2"></i>Blog Preview</h4>
                        <div class="blog-content-preview" id="blogPreview">
                            {{ blog_content[:500] }}...
                        </div>
                        <button class="btn btn-sm btn-outline-orange mt-2" onclick="togglePreview()">
                            <span id="toggleText">Show Full Content</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Blog Content -->
        <div class="blog-section">
            <div class="blog-header">
                <h3><i class="fas fa-blog me-2"></i>Generated Blog Post</h3>
                <div class="blog-meta">
                    <span class="meta-item"><i class="fas fa-calendar me-1"></i>{{ moment().format('MMMM Do, YYYY') }}</span>
                    <span class="meta-item"><i class="fas fa-user me-1"></i>{{ current_user.username }}</span>
                </div>
            </div>
            
            <div class="blog-content" id="blogContent">
                {{ blog_content|safe|nl2br }}
            </div>
        </div>
        
        <!-- Feedback Section -->
        <div class="feedback-section mt-5">
            <div class="feedback-card">
                <h4><i class="fas fa-star me-2"></i>How was your experience?</h4>
                <div class="rating-buttons">
                    <button title="#" class="btn btn-outline-light rating-btn" data-rating="5">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                    </button>
                    <button title="#" class="btn btn-outline-light rating-btn" data-rating="4">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i>
                    </button>
                    <button title="#" class="btn btn-outline-light rating-btn" data-rating="3">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
function copyToClipboard() {
    const content = document.getElementById('blogContent').innerText;
    navigator.clipboard.writeText(content).then(function() {
        showToast('Blog content copied to clipboard!', 'success');
    });
}

function togglePreview() {
    const preview = document.getElementById('blogPreview');
    const toggleText = document.getElementById('toggleText');
    const fullContent = `{{ blog_content|safe }}`;
    
    if (preview.innerHTML.includes('...')) {
        preview.innerHTML = fullContent;
        toggleText.textContent = 'Show Preview Only';
    } else {
        preview.innerHTML = fullContent.substring(0, 500) + '...';
        toggleText.textContent = 'Show Full Content';
    }
}

// Rating functionality
document.querySelectorAll('.rating-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const rating = this.dataset.rating;
        showToast(`Thank you for rating ${rating} stars!`, 'success');
        this.classList.add('active');
    });
});

// Download button animation
document.getElementById('downloadBtn').addEventListener('click', function() {
    this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating PDF...';
    setTimeout(() => {
        this.innerHTML = '<i class="fas fa-check me-2"></i>Downloaded!';
        setTimeout(() => {
            this.innerHTML = '<i class="fas fa-download me-2"></i>Download PDF';
        }, 2000);
    }, 1000);
});
</script>
{% endblock %}
